<!-- listEducators.ejs : This page displays the list of all educatorts-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Special Educators - Inclusive Learning Hub</title>
  <link rel="stylesheet" href="/css/adminStyle.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <style>
    /* ================= Modal and Overlay Styles ================= */
    .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    /* The key properties: initially none, and a high Z-index */
    display: none; 
    justify-content: center;
    align-items: center;
    z-index: 9999; /* Use a very high value to ensure it's on top */
    overflow-y: auto;
}

    .modal-card {
        background: #fff;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        width: 90%;
        max-width: 500px;
        position: relative;
        animation: fadeIn 0.3s ease-out;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #eee;
        padding-bottom: 15px;
        margin-bottom: 20px;
    }

    .modal-header h2 { margin: 0; color: #333; }

    #closeProfileModal {
        background: none;
        border: none;
        font-size: 2rem;
        cursor: pointer;
        color: #666;
        line-height: 1;
    }

    .modal-body { text-align: center; }

    .profile-photo {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        margin: 0 auto 20px;
        overflow: hidden;
        border: 4px solid #007bff;
        background-color: #f0f0f0;
    }

    .profile-photo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    #profileName { margin: 0 0 5px; color: #007bff; }

    #profileRole { color: #6c757d; font-style: italic; margin-bottom: 15px; }

    .modal-body p {
        margin: 5px 0;
        text-align: left;
        padding-left: 10%;
    }

    .modal-body p strong {
        min-width: 80px;
        display: inline-block;
        color: #333;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }

    
  </style>
</head>

<body>
  <!-- Sidebar -->
  <%- include("../partials/adminSidebar") %>

  <!-- Main Content -->
  <div class="main-content educators-page">
    <header>
      <div class="top-bar">
        <div class="welcome-text">Welcome back, Admin!</div>
        <div class="user-profile">
          <div class="profile-pic">A</div>
          <span>Admin User</span>
        </div>
      </div>
    </header>

    <div class="resource-toolbar">
      <div class="toolbar-header">
        <h2>Special Educators</h2>
      </div>
      <div class="search-box">
        <input type="text" placeholder="Search Users...">
      </div>
      <div class="actions">
        <a href="#" class="btn">Filter</a>
        <a href="/admin/addUser" class="btn" id="addUserButton">+ Add New User</a>
      </div>
    </div>

    <!-- Educator Cards -->
    <div class="content-section">
      <h3>Our Educators</h3>
      <div class="educator-grid">
        <% if (typeof educators !== 'undefined' && educators.length > 0) { %>
          <% educators.forEach((edu, index) => { %>
            <div class="educator-card">
              <div class="educator-avatar">
                <%= edu.firstName[0] %><%= edu.lastName[0] %>
              </div>
              <h4><%= edu.firstName %> <%= edu.lastName %></h4>
              <!--<p><%= edu.profile.bio || "Special Educator" %></p>-->
              <p><%= edu.role %></p>
              <a href="#" class="btn view-profile-btn" data-index="<%= index %>">View Profile</a>
            </div>
          <% }) %>
        <% } else { %>
          <p>No educators found.</p>
        <% } %>
      </div>
    </div>

    <!-- Add User Sidebar -->
    <div id="addUserSidebar" class="sidebar-overlay">
      <div class="sidebar-content">
        <div class="sidebar-header">
          <h2>Add New User</h2>
          <button id="closeSidebarBtn">&times;</button>
        </div>
        <form class="admin-form" id="addUserForm" action="/admin/addUser" method="POST">
          <div class="form-group">
            <label for="firstName">First Name</label>
            <input type="text" id="firstName" name="firstName" placeholder="Enter first name" required>
          </div>
          <div class="form-group">
            <label for="lastName">Last Name</label>
            <input type="text" id="lastName" name="lastName" placeholder="Enter last name" required>
          </div>
          <div class="form-group">
            <label for="userEmail">Email Address</label>
            <input type="email" id="userEmail" name="email" placeholder="Enter email" required>
          </div>
          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="phone" placeholder="Enter phone number" required>
          </div>
          <div class="form-group">
            <label for="userPassword">Password</label>
            <input type="password" id="userPassword" name="password" placeholder="Set a password" required>
          </div>
          <div class="form-group">
            <label for="confirmPassword">Confirm Password</label>
            <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm password" required>
          </div>
          <div class="form-group">
            <label for="role">Role</label>
            <select id="role" name="role" required>
              <option value="">-- Select Role --</option>
              <option value="admin">Admin</option>
              <option value="teacher">Teacher</option>
            </select>
          </div>
          <button type="submit" class="submit-btn"><span class="btn-text">Add User</span></button>
        </form>
      </div>
    </div>

    <!-- Educator Profile Modal -->
    <div id="educatorProfileModal" class="modal-overlay">
      <div class="modal-card">
        <div class="modal-header">
          <h2>Educator Profile</h2>
          <button id="closeProfileModal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="profile-photo">
            <img id="profilePhoto" src="/images/default-avatar.png" alt="Profile Photo">
          </div>
          <h3 id="profileName"></h3>
          <p id="profileRole"></p>
          <p><strong>Email:</strong> <span id="profileEmail"></span></p>
          <p><strong>Phone:</strong> <span id="profilePhone"></span></p>
          <p><strong>Bio:</strong> <span id="profileBio"></span></p>
          <p><strong>Status:</strong> <span id="profileStatus"></span></p>
          <p><strong>Created At:</strong> <span id="profileCreatedAt"></span></p>
        </div>
      </div>
    </div>

  </div> <!-- main-content ends -->

  <script>
    // Parse educators from server
    const educators = JSON.parse('<%- JSON.stringify(educators) %>');
    const modal = document.getElementById("educatorProfileModal");
    const closeModalBtn = document.getElementById("closeProfileModal");

    document.addEventListener("DOMContentLoaded", () => {
      // Sidebar toggle logic
      const addUserBtn = document.getElementById("addUserButton");
      const sidebar = document.getElementById("addUserSidebar");
      const closeSidebarBtn = document.getElementById("closeSidebarBtn");

      addUserBtn.addEventListener("click", e => {
        e.preventDefault();
        sidebar.classList.add("active");
      });

      closeSidebarBtn.addEventListener("click", () => sidebar.classList.remove("active"));
      window.addEventListener("click", e => { if(e.target === sidebar) sidebar.classList.remove("active"); });

      // Educator profile modal
      document.querySelectorAll(".educator-card a.view-profile-btn").forEach(btn => {
    btn.addEventListener("click", e => {
        e.preventDefault();

        // Get the index from data-index
        const index = btn.getAttribute("data-index");
        const educator = educators[index]; // safely get educator

        // Populate Modal
        document.getElementById("profileName").textContent = `${educator.firstName} ${educator.lastName}`;
        document.getElementById("profileRole").textContent = educator.role ? educator.role.toUpperCase() : "Role not specified";
        document.getElementById("profileEmail").textContent = educator.email;
        document.getElementById("profilePhone").textContent = educator.phone;
        document.getElementById("profileBio").textContent = educator.profile?.bio || "No bio provided";
        document.getElementById("profilePhoto").src = educator.profile?.photo && educator.profile.photo !== "" ? educator.profile.photo : "/images/default-avatar.png";
        document.getElementById("profileStatus").textContent = educator.isActive ? "Active" : "Inactive";
        document.getElementById("profileCreatedAt").textContent = educator.createdAt ? new Date(educator.createdAt).toLocaleDateString() : "N/A";

        // Show Modal
        modal.style.display = "flex";
    });
});

      closeModalBtn.addEventListener("click", () => modal.style.display = "none");
      modal.addEventListener("click", e => { if(e.target === modal) modal.style.display = "none"; });
    });

    // Educator search
const searchInput = document.querySelector('.search-box input');
searchInput.addEventListener('input', () => {
  const query = searchInput.value.toLowerCase();
  document.querySelectorAll('.educator-card').forEach(card => {
    const name = card.querySelector('h4').textContent.toLowerCase();
    const role = card.querySelector('p').textContent.toLowerCase();
    if (name.includes(query) || role.includes(query)) {
      card.style.display = 'block';
    } else {
      card.style.display = 'none';
    }
  });
});

  </script>
</body>
</html>
